<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Viewing of Grade</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white min-h-screen font-sans">

  <nav class="bg-slate-900/80 backdrop-blur-md border-b border-slate-700 px-8 py-4 flex justify-between items-center shadow-lg fixed top-0 left-0 w-full z-50">
    <h1 class="text-xl font-semibold text-indigo-400 tracking-wide">Barretto Senior High School</h1>
    <button onclick="logout()" class="bg-red-600 hover:bg-red-500 px-4 py-1.5 rounded-lg font-medium transition-all duration-300">
      Logout
    </button>
  </nav>

  <main class="max-w-5xl mx-auto mt-28 p-6">

<div class="flex flex-col sm:flex-row items-center sm:items-start bg-slate-900/60 backdrop-blur-md rounded-2xl p-6 shadow-xl border border-slate-700 mb-10">
      
      <div class="text-center sm:text-left">
        <h2 id="studentName" class="text-3xl font-bold text-indigo-400"></h2>
        <p id="studentID" class="text-slate-400 mt-1 text-sm"></p>
        <p class="mt-2 text-slate-300">Welcome back! Here’s your grades this quarter.</p>
      </div>
    </div>

       <section class="bg-slate-900/70 backdrop-blur-md rounded-2xl shadow-xl border border-slate-700 p-6">
      <h3 class="text-2xl font-semibold text-indigo-400 mb-4">Grades</h3>

      <div class="overflow-x-auto rounded-lg">
        <table class="w-full text-left border-collapse">
          <thead class="bg-slate-800/80 text-indigo-300">
            <tr>
              <th class="p-3 text-sm uppercase">Subject</th>
              <th class="p-3 text-center text-sm uppercase">Grade</th>
            </tr>
          </thead>
          <tbody id="gradesTable" class="divide-y divide-slate-700"></tbody>
        </table>
      </div>

            <div class="mt-8 text-center">
        <p class="text-slate-300 text-lg">General Average</p>
        <h3 id="studentAverage" class="text-5xl font-extrabold text-white mt-2 drop-shadow-lg"></h3>
        <p id="studentStatus" class="text-xl mt-3 font-semibold"></p>
      </div>
    </section>
  </main>

  <footer class="text-center text-slate-500 text-sm mt-16 mb-6">
    © 2025 Barretto Senior High School   </footer>

  <script>
       if (localStorage.getItem("studentLogged") !== "true") {
      window.location.href = "student-login.html";
    }

    const classKey = "bshsims_classes_admin";
    const classes = JSON.parse(localStorage.getItem(classKey) || "[]");
    const classIndex = localStorage.getItem("loggedClassIndex");
    const studentId = localStorage.getItem("loggedStudentId");

    const currentClass = classes[classIndex];
    const student = currentClass?.students?.find(s => s.id === studentId);

    if (!student) {
      window.location.href = "student-login.html";
    }

       document.getElementById("studentName").textContent = student.name;
    document.getElementById("studentID").textContent = "Student ID: " + student.id;

      const subjects = [
      "Piling Larang",
      "UCSP",
      "Contact Center Services",
      "EAPP",
      "PR2",
      "Personal Development",
      "PE"
    ];

       function renderGrades() {
      const gradesTable = document.getElementById("gradesTable");
      gradesTable.innerHTML = "";

      subjects.forEach(sub => {
        const grade = student.grades[sub] ?? "-";
        const colorClass =
          grade === "-" ? "text-slate-400" :
          grade >= 90 ? "text-green-400 font-semibold" :
          grade >= 75 ? "text-yellow-300 font-semibold" :
          "text-red-400 font-semibold";

        gradesTable.innerHTML += `
          <tr class="hover:bg-slate-800/70 transition-all">
            <td class="p-3">${sub}</td>
            <td class="p-3 text-center ${colorClass}">${grade}</td>
          </tr>
        `;
      });

           const validGrades = Object.values(student.grades).filter(g => g != null);
      const avg = validGrades.length
        ? (validGrades.reduce((a, b) => a + Number(b), 0) / validGrades.length).toFixed(2)
        : "-";
      const status = avg === "-" ? "-" : (avg >= 75 ? "✅ Passed" : "❌ Failed");

      document.getElementById("studentAverage").textContent = avg;
      document.getElementById("studentStatus").textContent =
        status === "-" ? "" :
        status.includes("Passed")
          ? " Status: Passed"
          : " Status: Failed";
      document.getElementById("studentStatus").className =
        status.includes("Passed")
          ? "text-green-400 text-xl mt-3 font-semibold"
          : "text-red-400 text-xl mt-3 font-semibold";
    }

 	    window.addEventListener("storage", () => {
      const updatedClasses = JSON.parse(localStorage.getItem(classKey) || "[]");
      const updatedClass = updatedClasses[classIndex];
      const updatedStudent = updatedClass?.students?.find(s => s.id === studentId);
      if (updatedStudent) {
        Object.assign(student, updatedStudent);
        renderGrades();
      }
    });

    renderGrades();

       function logout() {
      localStorage.removeItem("studentLogged");
      localStorage.removeItem("loggedStudentId");
      localStorage.removeItem("loggedClassIndex");
      window.location.href = "gradesystem.html";
    }
  </script>
</body>
</html>
